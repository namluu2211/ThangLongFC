<!-- Extracted template from players.component.ts (partial) -->
<div class="modern-container">
  <div class="players-orchestrator">
    <div class="analyzing-overlay" *ngIf="isAnalyzing">
      <div style="display:flex; flex-direction:column; align-items:center;">
  <div class="spinner" role="status" aria-label="ƒêang ph√¢n t√≠ch ƒë·ªôi h√¨nh"></div>
        <div class="label">ƒêang ph√¢n t√≠ch ƒë·ªôi h√¨nh...</div>
      </div>
    </div>
    <!-- Removed duplicate header (now provided by parent Tabs) -->

    <section class="players-toolbar" aria-label="Thanh c√¥ng c·ª• ƒë·ªôi h√¨nh">
      <div class="toolbar-left">
        <button class="tl-btn" (click)="toggleUseRegistered()" [attr.aria-pressed]="useRegistered">
          <i class="fas" [class.fa-user-check]="useRegistered" [class.fa-users]="!useRegistered"></i>
          {{ useRegistered ? 'ƒêƒÉng k√Ω (' + registeredPlayers.length + ')' : 'T·∫•t c·∫£ (' + allPlayers.length + ')' }}
        </button>
  <button class="tl-btn" (click)="toggleRegisteredFilter()" [attr.aria-pressed]="filterRegisteredOnly" title="Ch·ªâ hi·ªÉn th·ªã c·∫ßu th·ªß ƒë√£ ƒëƒÉng k√Ω">
          <i class="fas" [class.fa-filter]="!filterRegisteredOnly" [class.fa-filter-circle-check]="filterRegisteredOnly"></i>
        </button>
        <button class="tl-btn" (click)="clearRegisteredPlayers()" [disabled]="registeredPlayers.length===0" title="X√≥a danh s√°ch ƒëƒÉng k√Ω">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      <div class="toolbar-center">
        <span class="mode-indicator">{{ getPlayerModeStatus() }}</span>
      </div>
      <div class="toolbar-right">
  <!-- Allow viewers to shuffle teams (read-only action) -->
  <button class="tl-btn" (click)="shuffleRegisteredTeams()" [disabled]="(registeredPlayers.length<2 && allPlayers.length<2)" [title]="(registeredPlayers.length<2 && allPlayers.length>=2) ? 'S·ª≠ d·ª•ng to√†n b·ªô danh s√°ch v√¨ ch∆∞a c√≥ ƒëƒÉng k√Ω' : ( (registeredPlayers.length<2 && allPlayers.length<2) ? 'C·∫ßn ‚â•2 c·∫ßu th·ªß' : 'Chia ƒë·ªôi ng·∫´u nhi√™n')"><i class="fas fa-shuffle"></i> Chia ƒë·ªôi</button>
  <button class="tl-btn" (click)="clearTeams()" [disabled]="(!teamA.length && !teamB.length)" appDisableUnlessCanEdit title="X√≥a ƒë·ªôi h√¨nh"><i class="fas fa-rotate-left"></i></button>
      <button class="tl-btn" (click)="runAIAnalysis()" [disabled]="!teamA.length || !teamB.length" title="Ph√¢n t√≠ch ƒë·ªôi h√¨nh"><i class="fas fa-robot"></i> AI</button>
  <!-- Allow viewers to run AI analysis (read-only) -->
  <button class="tl-btn primary" *appCanEdit (click)="saveMatchInfo()" [disabled]="!teamA.length || !teamB.length" aria-label="L∆∞u tr·∫≠n ƒë·∫•u" title="L∆∞u tr·∫≠n ƒë·∫•u"><i class="fas fa-save"></i> L∆∞u tr·∫≠n ƒë·∫•u</button>
      </div>
    </section>

    <!-- Collapsible Player List -->
    <section class="players-list-wrapper" aria-labelledby="playersListHeading" [class.collapsed]="!showPlayerList">
      <header class="players-list-header">
        <h3 id="playersListHeading" class="players-list-title">
          <i class="fas fa-address-book"></i>
          Danh s√°ch c·∫ßu th·ªß
        </h3>
        <button type="button"
                class="collapse-toggle"
                (click)="togglePlayerListView()"
                [attr.aria-expanded]="showPlayerList"
                [attr.aria-controls]="'playersListContent'"
                [title]="showPlayerList ? 'Thu g·ªçn danh s√°ch' : 'M·ªü r·ªông danh s√°ch'">
          <i class="fas" [class.fa-chevron-up]="showPlayerList" [class.fa-chevron-down]="!showPlayerList"></i>
        </button>
      </header>
      <div id="playersListContent" class="players-list-content" [attr.hidden]="!showPlayerList ? '' : null">
        <app-player-list
          [showPlayerList]="showPlayerList"
          [paginatedPlayers]="getPaginatedPlayers()"
          [displayPlayers]="getDisplayPlayers()"
          [pageSize]="pageSize"
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          [registeredPlayers]="registeredPlayers"
          [canEdit]="canEdit"
          (toggleRegistration)="toggleRegistration($event)"
          (previousPage)="previousPage()"
          (nextPage)="nextPage()"
          (savePlayers)="savePlayers()"
          (viewPlayer)="viewPlayer($event)"
          (toggleList)="togglePlayerListView()"
          (reload)="loadPlayers()"
          (deletePlayer)="deletePlayer($event)"
          (editPlayer)="startEditPlayer($event)"
        ></app-player-list>
      </div>
    </section>



    <app-teams-panel
      [teamA]="teamA"
      [teamB]="teamB"
      [scoreA]="scoreA"
      [scoreB]="scoreB"
      [goalsA]="goalsA"
      [goalsB]="goalsB"
      [yellowCardsA]="yellowCardsA"
      [yellowCardsB]="yellowCardsB"
      [redCardsA]="redCardsA"
      [redCardsB]="redCardsB"
      (scoreAChange)="scoreA = $event"
      (scoreBChange)="scoreB = $event"
      (removePlayer)="removeFromTeam($event.player, $event.team)"
      (teamDrop)="onTeamDropped($event)"
    ></app-teams-panel>

    <!-- Match Events Inputs -->
    <section class="match-events" *ngIf="teamA.length || teamB.length">
      <h3 class="events-title"><i class="fas fa-clipboard-list me-2"></i>S·ª± ki·ªán tr·∫≠n ƒë·∫•u</h3>
  <app-readonly-banner [canEdit]="canEdit"></app-readonly-banner>
      <div class="events-grid">
        <!-- Team A Events -->
        <div class="events-card team-a">
          <h4>ƒê·ªôi Xanh</h4>
          <div class="event-group">
            <h5>Ghi b√†n</h5>
            <div class="inline-form">
              <select [(ngModel)]="_gaPlayerA" aria-label="Ch·ªçn c·∫ßu th·ªß ghi b√†n ƒë·ªôi A" appDisableUnlessCanEdit>
                <option [ngValue]="null">C·∫ßu th·ªß</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <select [(ngModel)]="_gaAssistA" aria-label="Ch·ªçn ki·∫øn t·∫°o ƒë·ªôi A" appDisableUnlessCanEdit>
                <option [ngValue]="null">Ki·∫øn t·∫°o</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_gaMinuteA" placeholder="Ph√∫t" appDisableUnlessCanEdit />
              <button (click)="addGoal('A', _gaPlayerA!, _gaMinuteA || 0, _gaAssistA||undefined); _gaPlayerA=null; _gaAssistA=null; _gaMinuteA=null" [disabled]="!_gaPlayerA" appDisableUnlessCanEdit title="Th√™m b√†n th·∫Øng"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let g of goalsA; let i=index">
                <span class="badge goal">‚öΩ {{ getPlayerName(g.playerId) }} <small *ngIf="g.minute!==undefined">({{g.minute}}')</small><span *ngIf="g.assistId"> - KT: {{ getPlayerName(g.assistId) }}</span></span>
                <button class="remove" *appCanEdit (click)="removeGoal('A',i)">√ó</button>
              </li>
            </ul>
          </div>
          <div class="event-group">
            <h5>Th·∫ª</h5>
            <div class="inline-form">
              <select [(ngModel)]="_ycPlayerA" [disabled]="!canEdit">
                <option [ngValue]="null">V√†ng</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_ycMinuteA" placeholder="Ph√∫t" [disabled]="!canEdit" />
              <button (click)="addCard('yellow','A',_ycPlayerA!, _ycMinuteA||0); _ycPlayerA=null; _ycMinuteA=null" [disabled]="!_ycPlayerA || !canEdit" title="Th√™m th·∫ª v√†ng"><i class="fas fa-plus"></i></button>
            </div>
            <div class="inline-form">
              <select [(ngModel)]="_rcPlayerA" [disabled]="!canEdit">
                <option [ngValue]="null">ƒê·ªè</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_rcMinuteA" placeholder="Ph√∫t" [disabled]="!canEdit" />
              <button (click)="addCard('red','A',_rcPlayerA!, _rcMinuteA||0); _rcPlayerA=null; _rcMinuteA=null" [disabled]="!_rcPlayerA || !canEdit" title="Th√™m th·∫ª ƒë·ªè"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let c of yellowCardsA; let yi=index">
                <span class="badge yc">üü® {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" *appCanEdit (click)="removeCard('yellow','A',yi)">√ó</button>
              </li>
              <li *ngFor="let c of redCardsA; let ri=index">
                <span class="badge rc">üü• {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" *appCanEdit (click)="removeCard('red','A',ri)">√ó</button>
              </li>
            </ul>
          </div>
        </div>
        <!-- Team B Events -->
        <div class="events-card team-b">
          <h4>ƒê·ªôi Cam</h4>
          <div class="event-group">
            <h5>Ghi b√†n</h5>
            <div class="inline-form">
              <select [(ngModel)]="_gaPlayerB" [disabled]="!canEdit">
                <option [ngValue]="null">C·∫ßu th·ªß</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <select [(ngModel)]="_gaAssistB" [disabled]="!canEdit">
                <option [ngValue]="null">Ki·∫øn t·∫°o</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_gaMinuteB" placeholder="Ph√∫t" [disabled]="!canEdit" />
              <button (click)="addGoal('B', _gaPlayerB!, _gaMinuteB || 0, _gaAssistB||undefined); _gaPlayerB=null; _gaAssistB=null; _gaMinuteB=null" [disabled]="!_gaPlayerB || !canEdit" title="Th√™m b√†n th·∫Øng"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let g of goalsB; let i=index">
                <span class="badge goal">‚öΩ {{ getPlayerName(g.playerId) }} <small *ngIf="g.minute!==undefined">({{g.minute}}')</small><span *ngIf="g.assistId"> - KT: {{ getPlayerName(g.assistId) }}</span></span>
                <button class="remove" *appCanEdit (click)="removeGoal('B',i)">√ó</button>
              </li>
            </ul>
          </div>
          <div class="event-group">
            <h5>Th·∫ª</h5>
            <div class="inline-form">
              <select [(ngModel)]="_ycPlayerB" [disabled]="!canEdit">
                <option [ngValue]="null">V√†ng</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_ycMinuteB" placeholder="Ph√∫t" [disabled]="!canEdit" />
              <button (click)="addCard('yellow','B',_ycPlayerB!, _ycMinuteB||0); _ycPlayerB=null; _ycMinuteB=null" [disabled]="!_ycPlayerB || !canEdit" title="Th√™m th·∫ª v√†ng"><i class="fas fa-plus"></i></button>
            </div>
            <div class="inline-form">
              <select [(ngModel)]="_rcPlayerB" [disabled]="!canEdit">
                <option [ngValue]="null">ƒê·ªè</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_rcMinuteB" placeholder="Ph√∫t" [disabled]="!canEdit" />
              <button (click)="addCard('red','B',_rcPlayerB!, _rcMinuteB||0); _rcPlayerB=null; _rcMinuteB=null" [disabled]="!_rcPlayerB || !canEdit" title="Th√™m th·∫ª ƒë·ªè"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let c of yellowCardsB; let yi=index">
                <span class="badge yc">üü® {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" *appCanEdit (click)="removeCard('yellow','B',yi)">√ó</button>
              </li>
              <li *ngFor="let c of redCardsB; let ri=index">
                <span class="badge rc">üü• {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" *appCanEdit (click)="removeCard('red','B',ri)">√ó</button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Thu/Chi Section -->
  <section class="finance-summary" role="region" aria-labelledby="financeHeading">
    <h3 id="financeHeading" class="finance-title"><i class="fas fa-coins me-2"></i>Thu/Chi tr·∫≠n ƒë·∫•u</h3>
      <div class="finance-grid">
        <div class="finance-card">
          <h4>Thu nh·∫≠p</h4>
          <div class="fin-row"><label for="revWin"><i class="fas fa-trophy"></i> Ph√≠ ƒë·ªôi th·∫Øng</label><input id="revWin" aria-label="Ph√≠ ƒë·ªôi th·∫Øng" type="number" min="0" [(ngModel)]="_revWinner"/></div>
          <div class="fin-row"><label for="revLose"><i class="fas fa-user-group"></i> Ph√≠ ƒë·ªôi thua</label><input id="revLose" aria-label="Ph√≠ ƒë·ªôi thua" type="number" min="0" [(ngModel)]="_revLoser"/></div>
          <div class="fin-row"><label for="revCards"><i class="fas fa-square-minus"></i> Ph·∫°t th·∫ª</label><input id="revCards" aria-label="Ph√≠ ph·∫°t th·∫ª" type="number" min="0" [(ngModel)]="_revCards"/></div>
          <div class="fin-row"><label for="revOther"><i class="fas fa-circle-plus"></i> Kh√°c</label><input id="revOther" aria-label="Thu kh√°c" type="number" min="0" [(ngModel)]="_revOther"/></div>
          <div class="fin-total">T·ªïng thu: {{ (_revWinner||0)+(_revLoser||0)+(_revCards||0)+(_revOther||0) | number }}</div>
        </div>
        <div class="finance-card">
          <h4>Chi ph√≠</h4>
          <div class="fin-row"><label for="expWater"><i class="fas fa-droplet"></i> N∆∞·ªõc</label><input id="expWater" aria-label="Chi ph√≠ n∆∞·ªõc" type="number" min="0" [(ngModel)]="_expWater"/></div>
          <div class="fin-row"><label for="expField"><i class="fas fa-futbol"></i> S√¢n</label><input id="expField" aria-label="Chi ph√≠ s√¢n" type="number" min="0" [(ngModel)]="_expField"/></div>
          <div class="fin-row"><label for="expRef"><i class="fas fa-whistle"></i> Tr·ªçng t√†i</label><input id="expRef" aria-label="Chi ph√≠ tr·ªçng t√†i" type="number" min="0" [(ngModel)]="_expRef"/></div>
          <div class="fin-row"><label for="expOther"><i class="fas fa-ellipsis"></i> Kh√°c</label><input id="expOther" aria-label="Chi ph√≠ kh√°c" type="number" min="0" [(ngModel)]="_expOther"/></div>
          <div class="fin-total">T·ªïng chi: {{ (_expWater||0)+(_expField||0)+(_expRef||0)+(_expOther||0) | number }}</div>
        </div>
        <div class="finance-card summary">
          <h4>T·ªïng k·∫øt</h4>
          <div class="fin-row flat"><span>Thu nh·∫≠p:</span><strong>{{ ((_revWinner||0)+(_revLoser||0)+(_revCards||0)+(_revOther||0)) | number }} VND</strong></div>
          <div class="fin-row flat"><span>Chi ph√≠:</span><strong>{{ ((_expWater||0)+(_expField||0)+(_expRef||0)+(_expOther||0)) | number }} VND</strong></div>
          <div class="profit" [class.negative]="profit()<0">L·ª£i nhu·∫≠n: {{ profit() | number }} VND</div>
        </div>
      </div>
    </section>

    <!-- Legacy DnD component removed: integrated drag & drop now inside TeamsPanel -->

    <ng-container *ngIf="teamA.length && teamB.length">
      <ng-container *ngIf="aiLoaded">
        <ng-container *ngComponentOutlet="aiComponent; inputs: { teamA: teamA, teamB: teamB, ai: aiAnalysisResults, isAnalyzing: isAnalyzing, runAnalysis: runAIAnalysis }"></ng-container>
      </ng-container>
    </ng-container>


  </div>
  <div class="save-status-inline" *ngIf="matchSaveMessage">{{ matchSaveMessage }}</div>
