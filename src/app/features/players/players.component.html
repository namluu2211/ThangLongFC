<!-- Extracted template from players.component.ts (partial) -->
<div class="modern-container">
  <div class="players-orchestrator">
    <div class="analyzing-overlay" *ngIf="isAnalyzing">
      <div style="display:flex; flex-direction:column; align-items:center;">
        <div class="spinner" role="status" aria-label="ƒêang ph√¢n t√≠ch AI"></div>
        <div class="label">ƒêang ph√¢n t√≠ch ƒë·ªôi h√¨nh...</div>
      </div>
    </div>
    <section class="players-header">
            <h2 id="playersHeading" class="page-title"><i class="fas fa-users me-2"></i>‚öΩ Qu·∫£n l√Ω ƒë·ªôi h√¨nh</h2>
            <p id="playersSubheading" class="page-subtitle">Chia ƒë·ªôi v√† ghi nh·∫≠n th√†nh t√≠ch tr·∫≠n ƒë·∫•u</p>
    </section>

    <section class="players-toolbar" aria-label="Thanh c√¥ng c·ª• ƒë·ªôi h√¨nh">
      <div class="toolbar-left">
        <button class="tl-btn" (click)="togglePlayerListView()" [attr.aria-pressed]="showPlayerList">
          <i class="fas fa-list"></i>
          {{ showPlayerList ? '·∫®n danh s√°ch' : 'Hi·ªán danh s√°ch' }}
        </button>
        <button class="tl-btn" (click)="toggleUseRegistered()" [attr.aria-pressed]="useRegistered">
          <i class="fas" [class.fa-user-check]="useRegistered" [class.fa-users]="!useRegistered"></i>
          {{ useRegistered ? 'ƒêƒÉng k√Ω (' + registeredPlayers.length + ')' : 'T·∫•t c·∫£ (' + allPlayers.length + ')' }}
        </button>
        <button class="tl-btn" (click)="clearRegisteredPlayers()" [disabled]="registeredPlayers.length===0" title="X√≥a danh s√°ch ƒëƒÉng k√Ω">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      <div class="toolbar-center">
        <span class="mode-indicator">{{ getPlayerModeStatus() }}</span>
      </div>
      <div class="toolbar-right">
        <button class="tl-btn" (click)="shuffleRegisteredTeams()" [disabled]="registeredPlayers.length < 2"><i class="fas fa-shuffle"></i> Chia ƒë·ªôi</button>
        <button class="tl-btn" (click)="clearTeams()" [disabled]="!teamA.length && !teamB.length"><i class="fas fa-rotate-left"></i></button>
        <button class="tl-btn primary" (click)="saveMatchInfo()" [disabled]="teamA.length === 0 && teamB.length === 0"><i class="fas fa-save"></i> L∆∞u</button>
        <button class="tl-btn" (click)="runAIAnalysis()" [disabled]="!teamA.length || !teamB.length" title="Ph√¢n t√≠ch AI"><i class="fas fa-robot"></i></button>
      </div>
    </section>

    <app-player-list
      [showPlayerList]="showPlayerList"
      [paginatedPlayers]="getPaginatedPlayers()"
      [displayPlayers]="getDisplayPlayers()"
      [pageSize]="pageSize"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [registeredPlayers]="registeredPlayers"
      (toggleRegistration)="toggleRegistration($event)"
      (previousPage)="previousPage()"
      (nextPage)="nextPage()"
      (savePlayers)="savePlayers()"
      (viewPlayer)="viewPlayer($event)"
      (toggleList)="togglePlayerListView()"
      (reload)="loadPlayers()"
      (deletePlayer)="deletePlayer($event)"
    ></app-player-list>

    <app-teams-panel
      [teamA]="teamA"
      [teamB]="teamB"
      [scoreA]="scoreA"
      [scoreB]="scoreB"
      [goalsTextA]="goalsTextA" [goalsTextB]="goalsTextB"
      [assistsTextA]="assistsTextA" [assistsTextB]="assistsTextB"
      [yellowTextA]="yellowTextA" [yellowTextB]="yellowTextB"
      [redTextA]="redTextA" [redTextB]="redTextB"
      (scoreAChange)="scoreA = $event"
      (scoreBChange)="scoreB = $event"
      (goalsTextChange)="onGoalsTextChange($event)"
      (assistsTextChange)="onAssistsTextChange($event)"
      (yellowTextChange)="onYellowTextChange($event)"
      (redTextChange)="onRedTextChange($event)"
      (removePlayer)="removeFromTeam($event.player, $event.team)"
      (teamDrop)="onTeamDropped($event)"
    ></app-teams-panel>

    <!-- Match Events Inputs -->
    <section class="match-events" *ngIf="teamA.length || teamB.length">
      <h3 class="events-title"><i class="fas fa-clipboard-list me-2"></i>S·ª± ki·ªán tr·∫≠n ƒë·∫•u</h3>
      <div class="events-grid">
        <!-- Team A Events -->
        <div class="events-card team-a">
          <h4>ƒê·ªôi Xanh</h4>
          <div class="event-group">
            <h5>Ghi b√†n</h5>
            <div class="inline-form">
              <select [(ngModel)]="_gaPlayerA" aria-label="Ch·ªçn c·∫ßu th·ªß ghi b√†n ƒë·ªôi A">
                <option [ngValue]="null">C·∫ßu th·ªß</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <select [(ngModel)]="_gaAssistA" aria-label="Ch·ªçn ki·∫øn t·∫°o ƒë·ªôi A">
                <option [ngValue]="null">Ki·∫øn t·∫°o</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_gaMinuteA" placeholder="Ph√∫t" />
              <button (click)="addGoal('A', _gaPlayerA!, _gaMinuteA || 0, _gaAssistA||undefined); _gaPlayerA=null; _gaAssistA=null; _gaMinuteA=null" [disabled]="!_gaPlayerA" title="Th√™m b√†n th·∫Øng"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let g of goalsA; let i=index">
                <span class="badge goal">‚öΩ {{ getPlayerName(g.playerId) }} <small *ngIf="g.minute!==undefined">({{g.minute}}')</small><span *ngIf="g.assistId"> - KT: {{ getPlayerName(g.assistId) }}</span></span>
                <button class="remove" (click)="removeGoal('A',i)">√ó</button>
              </li>
            </ul>
          </div>
          <div class="event-group">
            <h5>Th·∫ª</h5>
            <div class="inline-form">
              <select [(ngModel)]="_ycPlayerA">
                <option [ngValue]="null">V√†ng</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_ycMinuteA" placeholder="Ph√∫t" />
              <button (click)="addCard('yellow','A',_ycPlayerA!, _ycMinuteA||0); _ycPlayerA=null; _ycMinuteA=null" [disabled]="!_ycPlayerA" title="Th√™m th·∫ª v√†ng"><i class="fas fa-plus"></i></button>
            </div>
            <div class="inline-form">
              <select [(ngModel)]="_rcPlayerA">
                <option [ngValue]="null">ƒê·ªè</option>
                <option *ngFor="let p of teamA" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_rcMinuteA" placeholder="Ph√∫t" />
              <button (click)="addCard('red','A',_rcPlayerA!, _rcMinuteA||0); _rcPlayerA=null; _rcMinuteA=null" [disabled]="!_rcPlayerA" title="Th√™m th·∫ª ƒë·ªè"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let c of yellowCardsA; let yi=index">
                <span class="badge yc">üü® {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" (click)="removeCard('yellow','A',yi)">√ó</button>
              </li>
              <li *ngFor="let c of redCardsA; let ri=index">
                <span class="badge rc">üü• {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" (click)="removeCard('red','A',ri)">√ó</button>
              </li>
            </ul>
          </div>
        </div>
        <!-- Team B Events -->
        <div class="events-card team-b">
          <h4>ƒê·ªôi Cam</h4>
          <div class="event-group">
            <h5>Ghi b√†n</h5>
            <div class="inline-form">
              <select [(ngModel)]="_gaPlayerB">
                <option [ngValue]="null">C·∫ßu th·ªß</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <select [(ngModel)]="_gaAssistB">
                <option [ngValue]="null">Ki·∫øn t·∫°o</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_gaMinuteB" placeholder="Ph√∫t" />
              <button (click)="addGoal('B', _gaPlayerB!, _gaMinuteB || 0, _gaAssistB||undefined); _gaPlayerB=null; _gaAssistB=null; _gaMinuteB=null" [disabled]="!_gaPlayerB" title="Th√™m b√†n th·∫Øng"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let g of goalsB; let i=index">
                <span class="badge goal">‚öΩ {{ getPlayerName(g.playerId) }} <small *ngIf="g.minute!==undefined">({{g.minute}}')</small><span *ngIf="g.assistId"> - KT: {{ getPlayerName(g.assistId) }}</span></span>
                <button class="remove" (click)="removeGoal('B',i)">√ó</button>
              </li>
            </ul>
          </div>
          <div class="event-group">
            <h5>Th·∫ª</h5>
            <div class="inline-form">
              <select [(ngModel)]="_ycPlayerB">
                <option [ngValue]="null">V√†ng</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_ycMinuteB" placeholder="Ph√∫t" />
              <button (click)="addCard('yellow','B',_ycPlayerB!, _ycMinuteB||0); _ycPlayerB=null; _ycMinuteB=null" [disabled]="!_ycPlayerB" title="Th√™m th·∫ª v√†ng"><i class="fas fa-plus"></i></button>
            </div>
            <div class="inline-form">
              <select [(ngModel)]="_rcPlayerB">
                <option [ngValue]="null">ƒê·ªè</option>
                <option *ngFor="let p of teamB" [ngValue]="p.id">{{p.firstName}}</option>
              </select>
              <input type="number" min="0" max="120" [(ngModel)]="_rcMinuteB" placeholder="Ph√∫t" />
              <button (click)="addCard('red','B',_rcPlayerB!, _rcMinuteB||0); _rcPlayerB=null; _rcMinuteB=null" [disabled]="!_rcPlayerB" title="Th√™m th·∫ª ƒë·ªè"><i class="fas fa-plus"></i></button>
            </div>
            <ul class="event-list">
              <li *ngFor="let c of yellowCardsB; let yi=index">
                <span class="badge yc">üü® {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" (click)="removeCard('yellow','B',yi)">√ó</button>
              </li>
              <li *ngFor="let c of redCardsB; let ri=index">
                <span class="badge rc">üü• {{ getPlayerName(c.playerId) }} <small *ngIf="c.minute!==undefined">({{c.minute}}')</small></span>
                <button class="remove" (click)="removeCard('red','B',ri)">√ó</button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Thu/Chi Section -->
  <section class="finance-summary">
      <h3 class="finance-title"><i class="fas fa-coins me-2"></i>Thu/Chi tr·∫≠n ƒë·∫•u</h3>
      <div class="finance-grid">
        <div class="finance-card">
          <h4>Thu nh·∫≠p</h4>
          <div class="fin-row"><label for="revWin">Ph√≠ ƒë·ªôi th·∫Øng</label><input id="revWin" type="number" min="0" [(ngModel)]="_revWinner"/></div>
          <div class="fin-row"><label for="revLose">Ph√≠ ƒë·ªôi thua</label><input id="revLose" type="number" min="0" [(ngModel)]="_revLoser"/></div>
          <div class="fin-row"><label for="revCards">Ph·∫°t th·∫ª</label><input id="revCards" type="number" min="0" [(ngModel)]="_revCards"/></div>
          <div class="fin-row"><label for="revOther">Kh√°c</label><input id="revOther" type="number" min="0" [(ngModel)]="_revOther"/></div>
          <div class="fin-total">T·ªïng thu: {{ (_revWinner||0)+(_revLoser||0)+(_revCards||0)+(_revOther||0) | number }}</div>
        </div>
        <div class="finance-card">
          <h4>Chi ph√≠</h4>
          <div class="fin-row"><label for="expWater">N∆∞·ªõc</label><input id="expWater" type="number" min="0" [(ngModel)]="_expWater"/></div>
          <div class="fin-row"><label for="expField">S√¢n</label><input id="expField" type="number" min="0" [(ngModel)]="_expField"/></div>
          <div class="fin-row"><label for="expRef">Trong t√†i</label><input id="expRef" type="number" min="0" [(ngModel)]="_expRef"/></div>
          <div class="fin-row"><label for="expOther">Kh√°c</label><input id="expOther" type="number" min="0" [(ngModel)]="_expOther"/></div>
          <div class="fin-total">T·ªïng chi: {{ (_expWater||0)+(_expField||0)+(_expRef||0)+(_expOther||0) | number }}</div>
        </div>
        <div class="finance-card summary">
          <h4>T·ªïng k·∫øt</h4>
          <div class="fin-row flat"><span>Thu nh·∫≠p:</span><strong>{{ ((_revWinner||0)+(_revLoser||0)+(_revCards||0)+(_revOther||0)) | number }} VND</strong></div>
          <div class="fin-row flat"><span>Chi ph√≠:</span><strong>{{ ((_expWater||0)+(_expField||0)+(_expRef||0)+(_expOther||0)) | number }} VND</strong></div>
          <div class="profit" [class.negative]="profit()<0">L·ª£i nhu·∫≠n: {{ profit() | number }} VND</div>
        </div>
      </div>
    </section>

    <!-- Legacy DnD component removed: integrated drag & drop now inside TeamsPanel -->

    <div class="mt-3" *ngIf="teamA.length && teamB.length">
        <button class="modern-btn btn-outline-info btn-sm" (click)="loadAIComponent()" *ngIf="!aiLoaded" aria-label="Enable AI analysis">B·∫≠t ph√¢n t√≠ch AI</button>
    </div>
    <ng-container *ngIf="aiLoaded">
      <ng-container *ngComponentOutlet="aiComponent; inputs: { teamA: teamA, teamB: teamB, ai: aiAnalysisResults, isAnalyzing: isAnalyzing, runAnalysis: runAIAnalysis }"></ng-container>
    </ng-container>


  </div>
